@model PeaceInternational.Web.Models.TourcostDTO

@{
    ViewData["Title"] = Model.Tourcost.Id > 0 ? "Edit Tour Cost" : "Add Tour Cost";
}

<div class="animate-fade-in">
    <!-- Header -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
        <div>
            <h1 class="text-4xl font-bold text-base-content">@ViewData["Title"]</h1>
            <p class="text-base-content/70 mt-2">Configure tour cost details and pricing</p>
        </div>
        <a asp-action="Index" class="btn btn-ghost gap-2">
            <i class="fas fa-arrow-left"></i>
            Back to List
        </a>
    </div>

    <!-- Main Form -->
    <form asp-action="AddEdit" id="tourcostForm">
        <input type="hidden" asp-for="Tourcost.Id" />

        <!-- Top Section Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <!-- Days & Meal Plan Card -->
            <div class="card bg-base-100 shadow-lg">
                <div class="card-body">
                    <h2 class="card-title text-primary">
                        <i class="fas fa-calendar-day"></i>
                        Days & Meal Plan
                    </h2>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">Number of Days</span>
                        </label>
                        <input asp-for="Tourcost.Days" class="input input-bordered" type="number" min="1" />
                    </div>
                    <div class="divider my-2"></div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">Meal Type</span>
                        </label>
                        <div class="flex flex-col gap-2">
                            <label class="label cursor-pointer justify-start gap-3">
                                <input type="radio" asp-for="Tourcost.MealType" class="radio radio-primary" value="AP" />
                                <span class="label-text">AP (American Plan)</span>
                            </label>
                            <label class="label cursor-pointer justify-start gap-3">
                                <input type="radio" asp-for="Tourcost.MealType" class="radio radio-primary" value="MAP" />
                                <span class="label-text">MAP (Modified American Plan)</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Client & PAX Card -->
            <div class="card bg-base-100 shadow-lg">
                <div class="card-body">
                    <h2 class="card-title text-primary">
                        <i class="fas fa-user"></i>
                        Client Details
                    </h2>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">Client Name <span class="text-error">*</span></span>
                        </label>
                        <input asp-for="Tourcost.ClientName" class="input input-bordered" required />
                    </div>
                    <div class="divider my-2"></div>
                    <label class="label">
                        <span class="label-text font-semibold">PAX Range</span>
                    </label>
                    <div class="grid grid-cols-2 gap-2">
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text text-xs">Min PAX <span class="text-error">*</span></span>
                            </label>
                            <input asp-for="Tourcost.MinPAX" class="input input-bordered input-sm" type="number" min="1" />
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text text-xs">Max PAX <span class="text-error">*</span></span>
                            </label>
                            <input asp-for="Tourcost.MaxPAX" class="input input-bordered input-sm" type="number" max="100" />
                        </div>
                    </div>
                </div>
            </div>

            <!-- Guide Card -->
            <div class="card bg-base-100 shadow-lg">
                <div class="card-body">
                    <h2 class="card-title text-primary">
                        <i class="fas fa-user-tie"></i>
                        Guide
                    </h2>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">Name</span>
                        </label>
                        <select asp-for="Tourcost.GuideId" class="select select-bordered" asp-items="ViewBag.Guide">
                            <option value="">Select Guide</option>
                        </select>
                    </div>
                    <div class="divider my-2"></div>
                    <div class="grid grid-cols-3 gap-1">
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text text-xs">Half</span>
                            </label>
                            <input asp-for="Tourcost.GuideDaysHalfDay" class="input input-bordered input-sm" type="number" min="0" />
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text text-xs">Full</span>
                            </label>
                            <input asp-for="Tourcost.GuideDaysFullDay" class="input input-bordered input-sm" type="number" min="0" />
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text text-xs">Escort</span>
                            </label>
                            <input asp-for="Tourcost.GuideDaysEscort" class="input input-bordered input-sm" type="number" min="0" />
                        </div>
                    </div>
                </div>
            </div>

            <!-- Additional Categories Card -->
            <div class="card bg-base-100 shadow-lg">
                <div class="card-body">
                    <h2 class="card-title text-primary">
                        <i class="fas fa-tags"></i>
                        Additional Categories
                    </h2>
                    <div class="grid grid-cols-2 gap-2">
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text text-xs">Category 1</span>
                            </label>
                            <input asp-for="Tourcost.Category1" class="input input-bordered input-sm" />
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text text-xs">Category 2</span>
                            </label>
                            <input asp-for="Tourcost.Category2" class="input input-bordered input-sm" />
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text text-xs">Category 3</span>
                            </label>
                            <input asp-for="Tourcost.Category3" class="input input-bordered input-sm" />
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text text-xs">Category 4</span>
                            </label>
                            <input asp-for="Tourcost.Category4" class="input input-bordered input-sm" />
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tour Cost Details Collapse -->
        <div class="card bg-base-100 shadow-lg mb-6">
            <div class="card-body p-0">
                <div class="collapse collapse-arrow bg-primary text-primary-content">
                    <input type="checkbox" id="collapseToggle" />
                    <div class="collapse-title text-xl font-medium">
                        <i class="fas fa-list-alt mr-2"></i>
                        Add Tour Cost Details (Day by Day)
                    </div>
                    <div class="collapse-content bg-base-100 text-base-content">
                        <div class="pt-4">
                            <!-- Header Row -->
                            <div class="grid grid-cols-12 gap-2 mb-4 font-semibold text-sm text-base-content/70" id="tourCostDetailHeader">
                                <!-- Dynamically generated header -->
                            </div>
                            <div class="divider my-2"></div>
                            <!-- Detail Rows -->
                            <div id="tourCostDetailBody" class="space-y-3">
                                <!-- Dynamically generated rows -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Section -->
        <div class="card bg-base-100 shadow-lg mb-6">
            <div class="card-body">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Comment -->
                    <div class="form-control md:col-span-3">
                        <label class="label">
                            <span class="label-text font-semibold">
                                <i class="fas fa-comment mr-2"></i>
                                Comment
                            </span>
                        </label>
                        <input asp-for="Tourcost.Comment" class="input input-bordered" />
                    </div>

                    <!-- Discount Accommodation -->
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">Discount (Accommodation)</span>
                        </label>
                        <label class="input-group">
                            <input asp-for="Tourcost.DiscountAccomodation" class="input input-bordered flex-1" type="number" step="0.01" />
                            <span class="bg-base-300">%</span>
                        </label>
                    </div>

                    <!-- Discount Transportation -->
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">Discount (Transportation)</span>
                        </label>
                        <label class="input-group">
                            <input asp-for="Tourcost.DiscountTransportation" class="input input-bordered flex-1" type="number" step="0.01" />
                            <span class="bg-base-300">%</span>
                        </label>
                    </div>

                    <!-- Luxury Checkbox -->
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">Luxury Tour</span>
                        </label>
                        <label class="label cursor-pointer justify-start gap-3 border border-base-300 rounded-lg px-4 py-3">
                            <input asp-for="Tourcost.IsLuxury" class="checkbox checkbox-primary" type="checkbox" />
                            <span class="label-text">Mark as luxury tour</span>
                        </label>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="card-actions justify-end mt-6">
                    <button type="submit" class="btn btn-primary gap-2">
                        <i class="fas fa-save"></i>
                        @(Model.Tourcost.Id > 0 ? "Update Tour Cost" : "Save Tour Cost")
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts{
    <partial name="_ValidationScriptsPartial" />
    <script type="text/javascript">
        // Remove number input spinners
        const removeSpinners = () => {
            const style = document.createElement('style');
            style.textContent = `
                input::-webkit-outer-spin-button,
                input::-webkit-inner-spin-button {
                    -webkit-appearance: none;
                    margin: 0;
                }
                input[type=number] {
                    -moz-appearance: textfield;
                }
            `;
            document.head.appendChild(style);
        };
        removeSpinners();

        // Toast notification function
        const showToast = (type, message) => {
            Toast.show(type, message, 3000);
        };

        // Allow unchecking radio buttons with Ctrl+Click
        $('input[name="Tourcost.MealType"]').click(function (e) {
            if (e.ctrlKey) {
                $(this).prop('checked', false);
            }
        });

        function setData() {
            let sector = @Html.Raw(Json.Serialize(ViewBag.Sector));
            let hotelCatA = @Html.Raw(Json.Serialize(ViewBag.HotelCatA));
            let hotelCatB = @Html.Raw(Json.Serialize(ViewBag.HotelCatB));
            let hotelCatC = @Html.Raw(Json.Serialize(ViewBag.HotelCatC));

            var sectorDropdown = '';
            var hotelCatADropdown = '';
            var hotelCatBDropdown = '';
            var hotelCatCDropdown = '';

            let tourCostDetailHeader = `
                <div class="col-span-1">
                    <label class="label-text">Days</label>
                </div>
                <div class="col-span-2">
                    <label class="label-text">Sector 1</label>
                </div>
                <div class="col-span-2">
                    <label class="label-text">Sector 2</label>
                </div>
                <div class="col-span-2">
                    <label class="label-text">Sector 3</label>
                </div>
                <div class="col-span-2">
                    <label class="label-text">Hotel A</label>
                </div>
                <div class="col-span-1">
                    <label class="label-text">Hotel B</label>
                </div>
                <div class="col-span-2" id="hotelC">
                    <label class="label-text">Hotel C</label>
                </div>
            `;

            $('#tourCostDetailHeader').html(tourCostDetailHeader);
            $('#tourCostDetailHeader').removeClass('hidden');

            $.each(sector, function (idx, value) {
                sectorDropdown += `<option value="${value.value}">${value.text}</option>`;
            });

            $.each(hotelCatA, function (idx, value) {
                hotelCatADropdown += `<option value="${value.value}">${value.text}</option>`;
            });

            $.each(hotelCatB, function (idx, value) {
                hotelCatBDropdown += `<option value="${value.value}">${value.text}</option>`;
            });

            $.each(hotelCatC, function (idx, value) {
                hotelCatCDropdown += `<option value="${value.value}">${value.text}</option>`;
            });

            let days = $('#Tourcost_Days').val();
            let html = "";

            for (let i = 0; i < days; i++) {
                html += `
                    <div class="grid grid-cols-12 gap-2" id="detailRow${i}">
                        <input type="hidden" id="TourcostDetail_${i}__Id" name="TourcostDetail[${i}].Id"/>
                        <div class="col-span-1">
                            <input id="TourcostDetail_${i}__Day" name="TourcostDetail[${i}].Day"
                                   class="input input-bordered input-sm w-full" value="D${i + 1}" readonly/>
                        </div>
                        <div class="col-span-2">
                            <select id="TourcostDetail_${i}__Sector1Id" name="TourcostDetail[${i}].Sector1Id"
                                    class="select select-bordered select-sm w-full">
                                <option value="">Select</option>
                                ${sectorDropdown}
                            </select>
                        </div>
                        <div class="col-span-2">
                            <select id="TourcostDetail_${i}__Sector2Id" name="TourcostDetail[${i}].Sector2Id"
                                    class="select select-bordered select-sm w-full">
                                <option value="">Select</option>
                                ${sectorDropdown}
                            </select>
                        </div>
                        <div class="col-span-2">
                            <select id="TourcostDetail_${i}__Sector3Id" name="TourcostDetail[${i}].Sector3Id"
                                    class="select select-bordered select-sm w-full">
                                <option value="">Select</option>
                                ${sectorDropdown}
                            </select>
                        </div>
                        <div class="col-span-2">
                            <select id="TourcostDetail_${i}__HotelAId" name="TourcostDetail[${i}].HotelAId"
                                    class="select select-bordered select-sm w-full">
                                <option value="">Select</option>
                                ${hotelCatADropdown}
                            </select>
                        </div>
                        <div class="col-span-1">
                            <select id="TourcostDetail_${i}__HotelBId" name="TourcostDetail[${i}].HotelBId"
                                    class="select select-bordered select-sm w-full">
                                <option value="">Select</option>
                                ${hotelCatBDropdown}
                            </select>
                        </div>
                        <div class="col-span-2">
                            <select id="TourcostDetail_${i}__HotelCId" name="TourcostDetail[${i}].HotelCId"
                                    class="select select-bordered select-sm w-full">
                                <option value="">Select</option>
                                ${hotelCatCDropdown}
                            </select>
                        </div>
                    </div>
                `;
            }

            $('#tourCostDetailBody').html(html);

            for (let i = 0; i < days; i++) {
                $(`#TourcostDetail_${i}__Sector1Id`).rules("add", "required");
            }

            if ($('#Tourcost_Category1').val()) {
                catg1div();
            }

            if ($('#Tourcost_Category2').val()) {
                catg2div();
            }

            if ($('#Tourcost_Category3').val()) {
                catg3div();
            }

            if ($('#Tourcost_Category4').val()) {
                catg4div();
            }

            for (let i = 0; i < days; i++) {
                if ($('#Tourcost_Category1').val()) {
                    let row = `<div class="col-span-1">
                                <input type="text" id="TourcostDetail_${i}__Category1Cost"
                                       name="TourcostDetail[${i}].Category1Cost"
                                       class="input input-bordered input-sm w-full"/>
                                </div>`;
                    $(`#detailRow${i}`).children().eq(8).remove();
                    $(`#detailRow${i}`).append(row);
                }

                if ($('#Tourcost_Category2').val()) {
                    let row = `<div class="col-span-1">
                                <input type="text" id="TourcostDetail_${i}__Category2Cost"
                                       name="TourcostDetail[${i}].Category2Cost"
                                       class="input input-bordered input-sm w-full"/>
                                </div>`;
                    $(`#detailRow${i}`).children().eq(9).remove();
                    $(`#detailRow${i}`).append(row);
                }

                if ($('#Tourcost_Category3').val()) {
                    let row = `<div class="col-span-1">
                                <input type="text" id="TourcostDetail_${i}__Category3Cost"
                                       name="TourcostDetail[${i}].Category3Cost"
                                       class="input input-bordered input-sm w-full"/>
                                </div>`;
                    $(`#detailRow${i}`).children().eq(10).remove();
                    $(`#detailRow${i}`).append(row);
                }

                if ($('#Tourcost_Category4').val()) {
                    let row = `<div class="col-span-1">
                                <input type="text" id="TourcostDetail_${i}__Category4Cost"
                                       name="TourcostDetail[${i}].Category4Cost"
                                       class="input input-bordered input-sm w-full"/>
                                </div>`;
                    $(`#detailRow${i}`).children().eq(11).remove();
                    $(`#detailRow${i}`).append(row);
                }
            }
        }

        function catg1div() {
            $('<div class="col-span-1" id="catg1div"></div>').insertAfter('#hotelC');
            let cat1 = $('#Tourcost_Category1').val();
            let html = `<label class="label-text">
                            ${cat1}
                            <button type="button" class='btn btn-ghost btn-xs text-error' id="rmCat1">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </label>`;
            $('#catg1div').html(html);

            $('#rmCat1').on('click', function () {
                let rowLength = $('#tourCostDetailBody').find('.grid').length;
                $('#catg1div').remove();
                for (let i = 0; i < rowLength; i++) {
                    $(`#detailRow${i}`).children().eq(8).remove();
                }
                $('#Tourcost_Category1').val('');
            });
        }

        function catg2div() {
            let id = $('#catg1div').length ? '#catg1div' : '#hotelC';
            $('<div class="col-span-1" id="catg2div"></div>').insertAfter(id);
            let cat2 = $('#Tourcost_Category2').val();
            let html = `<label class="label-text">
                            ${cat2}
                            <button type="button" class='btn btn-ghost btn-xs text-error' id="rmCat2">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </label>`;
            $('#catg2div').html(html);

            $('#rmCat2').on('click', function () {
                let dist = $('#catg2div').prevUntil('#hotelC').length;
                let rowLength = $('#tourCostDetailBody').find('.grid').length;
                $('#catg2div').remove();
                for (let i = 0; i < rowLength; i++) {
                    $(`#detailRow${i}`).children().eq(8 + dist).remove();
                }
                $('#Tourcost_Category2').val('');
            });
        }

        function catg3div() {
            let id = '#hotelC';
            if ($('#catg2div').length) {
                id = '#catg2div';
            } else if ($('#catg1div').length) {
                id = '#catg1div';
            }

            $('<div class="col-span-1" id="catg3div"></div>').insertAfter(id);
            let cat3 = $('#Tourcost_Category3').val();
            let html = `<label class="label-text">
                            ${cat3}
                            <button type="button" class='btn btn-ghost btn-xs text-error' id="rmCat3">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </label>`;
            $('#catg3div').html(html);

            $('#rmCat3').on('click', function () {
                let dist = $('#catg3div').prevUntil('#hotelC').length;
                let rowLength = $('#tourCostDetailBody').find('.grid').length;
                $('#catg3div').remove();
                for (let i = 0; i < rowLength; i++) {
                    $(`#detailRow${i}`).children().eq(8 + dist).remove();
                }
                $('#Tourcost_Category3').val('');
            });
        }

        function catg4div() {
            let id = '#hotelC';
            if ($('#catg3div').length) {
                id = '#catg3div';
            } else if ($('#catg2div').length) {
                id = '#catg2div';
            } else if ($('#catg1div').length) {
                id = '#catg1div';
            }

            $('<div class="col-span-1" id="catg4div"></div>').insertAfter(id);
            let cat4 = $('#Tourcost_Category4').val();
            let html = `<label class="label-text">
                            ${cat4}
                            <button type="button" class='btn btn-ghost btn-xs text-error' id="rmCat4">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </label>`;
            $('#catg4div').html(html);

            $('#rmCat4').on('click', function () {
                let dist = $('#catg4div').prevUntil('#hotelC').length;
                let rowLength = $('#tourCostDetailBody').find('.grid').length;
                $('#catg4div').remove();
                for (let i = 0; i < rowLength; i++) {
                    $(`#detailRow${i}`).children().eq(8 + dist).remove();
                }
                $('#Tourcost_Category4').val('');
            });
        }

        $(document).ready(function () {
            var previousValue = [];
            var rowLength;

            var data = @Html.Raw(Json.Serialize(Model));

            if (!$('#Tourcost_DiscountAccomodation').val()) {
                $('#Tourcost_DiscountAccomodation').val(0);
            }

            if (!$('#Tourcost_DiscountTransportation').val()) {
                $('#Tourcost_DiscountTransportation').val(0);
            }

            if (data.tourcostDetail != null) {
                setData();

                for (let i = 0; i < data.tourcost.days; i++) {
                    $(`#TourcostDetail_${i}__Id`).val(data.tourcostDetail[i].id);
                    $(`#TourcostDetail_${i}__Day`).val(data.tourcostDetail[i].day);
                    $(`#TourcostDetail_${i}__Sector1Id`).val(data.tourcostDetail[i].sector1Id);
                    $(`#TourcostDetail_${i}__Sector2Id`).val(data.tourcostDetail[i].sector2Id);
                    $(`#TourcostDetail_${i}__Sector3Id`).val(data.tourcostDetail[i].sector3Id);
                    $(`#TourcostDetail_${i}__HotelAId`).val(data.tourcostDetail[i].hotelAId);
                    $(`#TourcostDetail_${i}__HotelBId`).val(data.tourcostDetail[i].hotelBId);
                    $(`#TourcostDetail_${i}__HotelCId`).val(data.tourcostDetail[i].hotelCId);
                    $(`#TourcostDetail_${i}__Category1Cost`).val(data.tourcostDetail[i].category1Cost);
                    $(`#TourcostDetail_${i}__Category2Cost`).val(data.tourcostDetail[i].category2Cost);
                    $(`#TourcostDetail_${i}__Category3Cost`).val(data.tourcostDetail[i].category3Cost);
                    $(`#TourcostDetail_${i}__Category4Cost`).val(data.tourcostDetail[i].category4Cost);
                }
            }

            $("#Tourcost_Days").on('focus', function () {
                previousValue = [];
                rowLength = $('#Tourcost_Days').val();
                for (let i = 0; i < rowLength; i++) {
                    previousValue.push({
                        Id: $(`#TourcostDetail_${i}__Id`).val(),
                        Sector1: $(`#TourcostDetail_${i}__Sector1Id`).val(),
                        Sector2: $(`#TourcostDetail_${i}__Sector2Id`).val(),
                        Sector3: $(`#TourcostDetail_${i}__Sector3Id`).val(),
                        HotelA: $(`#TourcostDetail_${i}__HotelAId`).val(),
                        HotelB: $(`#TourcostDetail_${i}__HotelBId`).val(),
                        HotelC: $(`#TourcostDetail_${i}__HotelCId`).val(),
                        Category1: $(`#TourcostDetail_${i}__Category1Cost`).val(),
                        Category2: $(`#TourcostDetail_${i}__Category2Cost`).val(),
                        Category3: $(`#TourcostDetail_${i}__Category3Cost`).val(),
                        Category4: $(`#TourcostDetail_${i}__Category4Cost`).val()
                    });
                }
            }).change(function () {
                setData();

                for (let i = 0; i < rowLength; i++) {
                    previousValue[i].Id ? $(`#TourcostDetail_${i}__Id`).val(previousValue[i].Id) : previousValue[i].Id;
                    previousValue[i].Sector1 ? $(`#TourcostDetail_${i}__Sector1Id`).val(previousValue[i].Sector1) : previousValue[i].Sector1;
                    previousValue[i].Sector2 ? $(`#TourcostDetail_${i}__Sector2Id`).val(previousValue[i].Sector2) : previousValue[i].Sector2;
                    previousValue[i].Sector3 ? $(`#TourcostDetail_${i}__Sector3Id`).val(previousValue[i].Sector3) : previousValue[i].Sector3;
                    previousValue[i].HotelA ? $(`#TourcostDetail_${i}__HotelAId`).val(previousValue[i].HotelA) : previousValue[i].HotelA;
                    previousValue[i].HotelB ? $(`#TourcostDetail_${i}__HotelBId`).val(previousValue[i].HotelB) : previousValue[i].HotelB;
                    previousValue[i].HotelC ? $(`#TourcostDetail_${i}__HotelCId`).val(previousValue[i].HotelC) : previousValue[i].HotelC;
                    previousValue[i].Category1 ? $(`#TourcostDetail_${i}__Category1Cost`).val(previousValue[i].Category1) : previousValue[i].Category1;
                    previousValue[i].Category2 ? $(`#TourcostDetail_${i}__Category2Cost`).val(previousValue[i].Category2) : previousValue[i].Category2;
                    previousValue[i].Category3 ? $(`#TourcostDetail_${i}__Category3Cost`).val(previousValue[i].Category3) : previousValue[i].Category3;
                    previousValue[i].Category4 ? $(`#TourcostDetail_${i}__Category4Cost`).val(previousValue[i].Category4) : previousValue[i].Category4;
                }
            });

            $('#Tourcost_Category2').on('keydown', function () {
                if (!$('#Tourcost_Category1').val()) {
                    $('#Tourcost_Category2').val('');
                    showToast('error', 'Fill Category 1 first');
                }
            });

            $('#Tourcost_Category3').on('keydown', function () {
                if (!$('#Tourcost_Category2').val()) {
                    $('#Tourcost_Category3').val('');
                    showToast('error', 'Fill Category 2 first');
                }
            });

            $('#Tourcost_Category4').on('keydown', function () {
                if (!$('#Tourcost_Category3').val()) {
                    $('#Tourcost_Category4').val('');
                    showToast('error', 'Fill Category 3 first');
                }
            });

            $('#Tourcost_Category1').on('change', function () {
                let flag = 0;

                if ($('#catg1div').length) {
                    $('#catg1div').remove();
                } else {
                    flag = 1;
                }

                catg1div();

                let isSameValue = window.confirm(`Do you want to use the same ${$('#Tourcost_Category1').val()} rate for all days?`);

                if (isSameValue) {
                    let value = window.prompt(`Enter cost for ${$('#Tourcost_Category1').val()}`);
                    value = value != null ? value : 0;
                    for (let i = 0; i < $('#Tourcost_Days').val(); i++) {
                        let row = `<div class="col-span-1">
                                    <input type="text" id="TourcostDetail_${i}__Category1Cost"
                                           name="TourcostDetail[${i}].Category1Cost"
                                           class="input input-bordered input-sm w-full" value="${value}"/>
                                    </div>`;

                        if (flag == 0) {
                            $(`#detailRow${i}`).children().eq(8).remove();
                        }

                        $(row).insertAfter($(`#detailRow${i}`).children().eq(7));
                    }
                } else {
                    for (let i = 0; i < $('#Tourcost_Days').val(); i++) {
                        let row = `<div class="col-span-1">
                                    <input type="text" id="TourcostDetail_${i}__Category1Cost"
                                           name="TourcostDetail[${i}].Category1Cost"
                                           class="input input-bordered input-sm w-full"/>
                                    </div>`;

                        if (flag == 0) {
                            $(`#detailRow${i}`).children().eq(8).remove();
                        }

                        $(row).insertAfter($(`#detailRow${i}`).children().eq(7));
                    }
                }
            });

            $('#Tourcost_Category2').on('change', function () {
                let flag = 0;

                if ($('#catg2div').length) {
                    $('#catg2div').remove();
                } else {
                    flag = 0;
                }

                catg2div();

                let isSameValue = window.confirm(`Do you want to use the same ${$('#Tourcost_Category2').val()} rate for all days?`);

                if (isSameValue) {
                    let value = window.prompt(`Enter cost for ${$('#Tourcost_Category2').val()}`);
                    for (let i = 0; i < $('#Tourcost_Days').val(); i++) {
                        let row = `<div class="col-span-1">
                                    <input type="text" id="TourcostDetail_${i}__Category2Cost"
                                           name="TourcostDetail[${i}].Category2Cost"
                                           class="input input-bordered input-sm w-full" value="${value}"/>
                                    </div>`;

                        if (flag == 0) {
                            $(`#detailRow${i}`).children().eq(9).remove();
                        }

                        $(row).insertAfter($(`#detailRow${i}`).children().eq(8));
                    }
                } else {
                    for (let i = 0; i < $('#Tourcost_Days').val(); i++) {
                        let row = `<div class="col-span-1">
                                    <input type="text" id="TourcostDetail_${i}__Category2Cost"
                                           name="TourcostDetail[${i}].Category2Cost"
                                           class="input input-bordered input-sm w-full"/>
                                    </div>`;

                        if (flag == 0) {
                            $(`#detailRow${i}`).children().eq(9).remove();
                        }
                        $(row).insertAfter($(`#detailRow${i}`).children().eq(8));
                    }
                }
            });

            $('#Tourcost_Category3').on('change', function () {
                let flag = 0;

                if ($('#catg3div').length) {
                    $('#catg3div').remove();
                } else {
                    flag = 1;
                }

                catg3div();

                let isSameValue = window.confirm(`Do you want to use the same ${$('#Tourcost_Category3').val()} rate for all days?`);
                if (isSameValue) {
                    let value = window.prompt(`Enter cost for ${$('#Tourcost_Category3').val()}`);
                    for (let i = 0; i < $('#Tourcost_Days').val(); i++) {
                        let row = `<div class="col-span-1">
                                    <input type="text" id="TourcostDetail_${i}__Category3Cost"
                                           name="TourcostDetail[${i}].Category3Cost"
                                           class="input input-bordered input-sm w-full" value="${value}"/>
                                    </div>`;
                        if (flag == 0) {
                            $(`#detailRow${i}`).children().eq(10).remove();
                        }
                        $(row).insertAfter($(`#detailRow${i}`).children().eq(9));
                    }
                } else {
                    for (let i = 0; i < $('#Tourcost_Days').val(); i++) {
                        let row = `<div class="col-span-1">
                                    <input type="text" id="TourcostDetail_${i}__Category3Cost"
                                           name="TourcostDetail[${i}].Category3Cost"
                                           class="input input-bordered input-sm w-full"/>
                                    </div>`;

                        if (flag == 0) {
                            $(`#detailRow${i}`).children().eq(10).remove();
                        }
                        $(row).insertAfter($(`#detailRow${i}`).children().eq(9));
                    }
                }
            });

            $('#Tourcost_Category4').on('change', function () {
                let flag = 0;

                if ($('#catg4div').length) {
                    $('#catg4div').remove();
                } else {
                    flag = 1;
                }

                catg4div();
                let isSameValue = window.confirm(`Do you want to use the same ${$('#Tourcost_Category4').val()} rate for all days?`);
                if (isSameValue) {
                    let value = window.prompt(`Enter cost for ${$('#Tourcost_Category4').val()}`);
                    for (let i = 0; i < $('#Tourcost_Days').val(); i++) {
                        let row = `<div class="col-span-1">
                                    <input type="text" id="TourcostDetail_${i}__Category4Cost"
                                           name="TourcostDetail[${i}].Category4Cost"
                                           class="input input-bordered input-sm w-full" value="${value}"/>
                                    </div>`;

                        if (flag == 0) {
                            $(`#detailRow${i}`).children().eq(11).remove();
                        }

                        $(row).insertAfter($(`#detailRow${i}`).children().eq(10));
                    }
                } else {
                    for (let i = 0; i < $('#Tourcost_Days').val(); i++) {
                        let row = `<div class="col-span-1">
                                    <input type="text" id="TourcostDetail_${i}__Category4Cost"
                                           name="TourcostDetail[${i}].Category4Cost"
                                           class="input input-bordered input-sm w-full"/>
                                    </div>`;

                        if (flag == 0) {
                            $(`#detailRow${i}`).children().eq(11).remove();
                        }
                        $(row).insertAfter($(`#detailRow${i}`).children().eq(10));
                    }
                }
            });
        });
    </script>
}
